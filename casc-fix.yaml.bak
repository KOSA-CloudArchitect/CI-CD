# casc-fix.yaml 파일에 이 내용을 저장하세요.
apiVersion: v1
kind: ConfigMap
metadata:
  annotations:
    meta.helm.sh/release-name: jenkins
    meta.helm.sh/release-namespace: jenkins
  labels:
    app.kubernetes.io/component: jenkins-controller
    app.kubernetes.io/instance: jenkins
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: jenkins
    helm.sh/chart: jenkins-5.8.73
    jenkins-jenkins-config: "true"
  name: jenkins-jenkins-jcasc-config
  namespace: jenkins
data:
  jcasc-default-config.yaml: |-
    jenkins:
      authorizationStrategy:
        loggedInUsersCanDoAnything:
          allowAnonymousRead: false
      securityRealm:
        local:
          allowsSignup: false
          users:
          - id: "${chart-admin-username}"
            name: "Jenkins Admin"
            password: "${chart-admin-password}"
      # 마스터에서는 빌드를 실행하지 않도록 설정
      numExecutors: 0
      clouds:
      - kubernetes:
          # --- 우리가 수정한 핵심 설정 ---
          name: "kubernetes"
          namespace: "jenkins"
          jenkinsUrl: "http://jenkins.jenkins.svc.cluster.local:8080"
          credentialsId: "KUBERNETES_SERVICE_ACCOUNT"
          skipTlsVerify: true
          podLabels:
          - key: "jenkins"
            value: "slave"
          # ------------------------------
      crumbIssuer:
        standard:
          excludeClientIPFromCrumb: true
